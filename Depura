import fitz  # PyMuPDF
import difflib

def extract_text(pdf_path):
    """Extrae el texto de un PDF y lo devuelve como una lista numerada de lÃ­neas."""
    doc = fitz.open(pdf_path)
    return [line for page in doc for line in page.get_text("text").splitlines()]

def comparar_textos(texto_anterior, texto_nuevo):
    """Compara dos listas de texto y devuelve diferencias con nÃºmero de lÃ­nea."""
    diff = list(difflib.ndiff(texto_anterior, texto_nuevo))
    agregado = [(i+1, line[2:]) for i, line in enumerate(diff) if line.startswith("+ ")]
    eliminado = [(i+1, line[2:]) for i, line in enumerate(diff) if line.startswith("- ")]

    return agregado, eliminado

# ğŸ“‚ Ruta de los archivos PDF
pdf_anterior = "lineamientos2024.pdf"
pdf_nuevo = "lineamientos2025.pdf"

# ğŸ“œ Extraer textos
texto_anterior = extract_text(pdf_anterior)
texto_nuevo = extract_text(pdf_nuevo)

# ğŸ” Comparar documentos
agregado, eliminado = comparar_textos(texto_anterior, texto_nuevo)

# ğŸ’¾ Guardar resultados con nÃºmero de lÃ­nea
with open("cambios_agregados.txt", "w", encoding="utf-8") as f:
    for linea, texto in agregado:
        f.write(f"LÃ­nea {linea}: {texto}\n")

with open("cambios_eliminados.txt", "w", encoding="utf-8") as f:
    for linea, texto in eliminado:
        f.write(f"LÃ­nea {linea}: {texto}\n")

print("âœ… ComparaciÃ³n completada. Revisa 'cambios_agregados.txt' y 'cambios_eliminados.txt'.")
